# Misc stuff
CMAKE_MINIMUM_REQUIRED(VERSION 3.10)

#Set compiler options
set(TOOLCHAIN_PREFIX /opt/airt/tools/cortexm/)

# All compiler related stuff is defined in the toolchain file
SET(STM32_CHIP "STM32F103C8")
SET(STM32_LINKER_SCRIPT ${CMAKE_CURRENT_SOURCE_DIR}/ldscripts/STM32F103C8Tx_FLASH.ld)
#SET(STM32_LINKER_SCRIPT ${CMSIS_LINKER_SCRIPT})
SET(STM32Cube_DIR /opt/STM32Cube_FW_F1_V1.6.0)

SET(CMAKE_TOOLCHAIN_FILE /opt/stm32-cmake/cmake/gcc_stm32.cmake)

ENABLE_LANGUAGE(ASM)

FIND_PACKAGE(CMSIS REQUIRED)

# Project definition
PROJECT(rfid-dk C)

ADD_DEFINITIONS(
	-DSTM32F1
	-DSTM32F103xB
	-DMCU_STM32F103CB
	-DF_CPU=72000000L
)

#add library to project
add_subdirectory(libs/STemWinLibrary532)
#link_directories(${GUI_LIB_SOURCE_PATH})

INCLUDE_DIRECTORIES(    
    ${CMSIS_INCLUDE_DIRS}
    ${STM32HAL_INCLUDE_DIR}
    ${GUI_LIB_INCLUDE_DIRS}
    ${CMAKE_CURRENT_SOURCE_DIR}/include
)

# Set this property, so CMake will know it's source file
SET_PROPERTY(SOURCE ${CMSIS_STARTUP_SOURCE} PROPERTY LANGUAGE C)

SET(PROJECT_SOURCES
    src/main.c
    src/spi.c
    src/systick.c
    src/ili9341.c
)

ADD_EXECUTABLE(${CMAKE_PROJECT_NAME} ${PROJECT_SOURCES} ${CMSIS_SOURCES} ${STM32HAL_SOURCES} )
TARGET_LINK_LIBRARIES(${CMAKE_PROJECT_NAME} ${GUI_LIB_NAME})
add_dependencies(${CMAKE_PROJECT_NAME} ${GUI_LIB_NAME})

STM32_SET_TARGET_PROPERTIES(${CMAKE_PROJECT_NAME})
STM32_ADD_HEX_BIN_TARGETS(${CMAKE_PROJECT_NAME})
STM32_PRINT_SIZE_OF_TARGETS(${CMAKE_PROJECT_NAME})